<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.mapper.ActiveMapper">

	<resultMap type="com.spring.myboard.ActiveVO" id="ActiveResultMap">
		<result property="last_connection" column="last_connection" />
		<result property="regist" column="regist" />
		<result property="board_count" column="board_count" />
		<result property="review_count" column="review_count" />
		<result property="comment_count" column="comment_count" />
		<result property="scrap_count" column="scrap_count" />
	</resultMap>

   <!-- 마지막 접속일 -->
   <select id="getLastconnection" parameterType="String" resultMap="ActiveResultMap">
		SELECT LAST_CONNECTION FROM MEMBER WHERE NICKNAME=#{nickname}   
   </select>
   
   <!-- 후기 -->
   <select id="getReviewCount" parameterType="String" resultType="int">
   		SELECT COUNT(*) FROM REVIEW WHERE NICKNAME=#{nickname}
   </select>
   
   <!-- 댓글 -->
   <select id="getRCommentCount" parameterType="String" resultType="int">
   		SELECT SUM(CNT) FROM(SELECT COUNT(*) CNT FROM BOARD_COMMENT WHERE NICKNAME=#{nickname} 
   		UNION ALL SELECT COUNT(*) CNT FROM BOARD_ANSWER WHERE NICKNAME=#{nickname}
   		UNION ALL SELECT COUNT(*) CNT FROM REVIEW_COMMENT WHERE NICKNAME=#{nickname}) 
   </select>
   
   <!-- 스크랩 -->
   <select id="getScrapCount" parameterType="String" resultType="int">
   		SELECT SUM(SCRAP_COUNT) FROM (SELECT SCRAP_COUNT FROM BOARD WHERE NICKNAME=#{nickname})
   </select>
   
   <!-- 게시글 -->
   <select id="getBoardCount" parameterType="String" resultType="int">
   		SELECT COUNT(*) FROM BOARD WHERE NICKNAME=#{nickname}
   </select>
   
   <!-- 최근 글 등록일 -->
   <select id="getWriteDate" parameterType="String" resultMap="ActiveResultMap">
   		SELECT MAX(REGIST) REGIST FROM BOARD GROUP BY #{nickname}
   </select>
   
   
</mapper>